<!DOCTYPE html>
<!--
================================================================================
UNIMARKET - HOMEPAGE (index.html)
================================================================================
PURPOSE: Landing page showcasing UniMarket platform to visitors
FEATURES:
- Hero section with call-to-action
- Platform statistics (users, transactions, happiness rate)
- Top selling products carousel
- Category showcase
- Navigation bar with authentication state

AUTHENTICATION STATE:
- Logged out: Shows "Log In" and "Sign Up" buttons
- Logged in: Shows icon buttons (notifications, messages, saved, profile)
- State managed by js/app.js (updateNavbarAuthState function)

KEY SECTIONS:
1. Header/Navigation (lines 16-58)
   - Logo and branding
   - Navigation links (Shop dropdown, About)
   - Search bar
   - User action buttons (responsive to auth state)
   
2. Hero Section (lines 65-90)
   - Main headline and subtitle
   - Call-to-action button
   - Platform statistics
   
3. Top Selling Section (lines 92-150+)
   - Product grid showcase
   - Sample products (replace with dynamic data in future)
   
4. Footer (bottom of page)
   - Links, branding, payment methods

JAVASCRIPT DEPENDENCIES:
- js/app.js: Handles navbar state, mobile menu, animations
- lucide@latest: Icon library for UI icons

HOW TO MODIFY:
- Change hero text: Find .hero-title and .hero-subtitle
- Change products shown: Modify product cards in top-selling section
- Change categories: Find category showcase section
- Change colors: Edit css/style.css (uses CSS variables)

LINKS:
- Products page: products.html (Shop button)
- Signup: signup-select-university.html
- Login: login.html
================================================================================
-->
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>UniMarket - Your Campus Marketplace</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Lucide Icons Library -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Socket.IO Client Library for real-time messaging -->
    <script src="https://cdn.socket.io/4.8.0/socket.io.min.js"></script>
    <!-- Fonts are imported in CSS -->
</head>

<body>

    <!-- Header -->
    <header class="site-header">
        <div class="container">
            <a href="index.html" class="logo">UniMarket</a>

            <nav class="nav-links">
                <!-- Shop Dropdown -->
                <div class="nav-dropdown">
                    <button class="nav-link nav-dropdown-trigger">
                        Shop
                        <i data-lucide="chevron-down" class="dropdown-icon"></i>
                    </button>
                    <div class="dropdown-menu">
                        <a href="products.html" class="dropdown-item">All Products</a>
                        <div class="dropdown-separator"></div>
                        <span class="dropdown-label">Categories</span>
                        <a href="products.html?category=Clothing" class="dropdown-item">Clothing</a>
                        <a href="products.html?category=Furniture" class="dropdown-item">Furniture</a>
                        <a href="products.html?category=Books" class="dropdown-item">Books</a>
                        <a href="products.html?category=Electronics" class="dropdown-item">Electronics</a>
                        <a href="products.html?category=Other" class="dropdown-item">Other</a>
                    </div>
                </div>

                <a href="about.html" class="nav-link">About</a>
            </nav>

            <div class="search-bar">
                <i data-lucide="search" class="search-icon"></i>
                <input type="text" placeholder="Search for textbooks, electronics..." class="input input-pill">
            </div>

            <div class="user-actions">
                <!-- Logged Out State -->
                <div id="logged-out-actions">
                    <a href="login.html" class="btn btn-ghost">Log In</a>
                    <a href="signup-select-university.html" class="btn btn-primary">Sign Up</a>
                </div>
                
                <!-- Logged In State -->
                <div id="logged-in-actions" class="hidden" style="display: flex; gap: 1rem; align-items: center;">
                    <a href="messages.html" class="btn-icon btn-ghost nav-icon" title="Messages" style="position: relative;">
                        <i data-lucide="message-square"></i>
                        <span class="notification-badge hidden" id="message-badge">0</span>
                    </a>
                    <a href="saved-items.html" class="btn-icon btn-ghost nav-icon" title="Saved Items">
                        <i data-lucide="bookmark"></i>
                    </a>
                    <div class="profile-dropdown" style="position: relative;">
                        <button class="btn-icon btn-ghost nav-icon profile-dropdown-trigger" title="Profile">
                            <i data-lucide="user"></i>
                        </button>
                        <div class="profile-dropdown-menu">
                            <a href="profile.html" class="dropdown-item">View Profile</a>
                            <a href="sell.html" class="dropdown-item">Make a Listing</a>
                            <button onclick="logout()" class="dropdown-item logout-btn">Log Out</button>
                        </div>
                    </div>
                </div>
            </div>

            <button class="mobile-menu-btn">
                <i data-lucide="menu"></i>
            </button>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
        <div class="flex flex-col gap-4">
            <!-- Logged Out State -->
            <div id="mobile-logged-out-actions">
                <a href="products.html" class="nav-link" style="font-size: 1.1rem; padding: 0.5rem 0;">Shop</a>
                <a href="about.html" class="nav-link" style="font-size: 1.1rem; padding: 0.5rem 0;">About</a>
                <hr style="border-color: var(--border); margin: 0.5rem 0;">
                <a href="login.html" class="btn btn-ghost" style="text-align: center; width: 100%;">Log In</a>
                <a href="signup-select-university.html" class="btn btn-primary" style="text-align: center; width: 100%;">Sign Up</a>
            </div>
            
            <!-- Logged In State -->
            <div id="mobile-logged-in-actions" class="hidden">
                <a href="products.html" class="nav-link" style="font-size: 1.1rem; padding: 0.5rem 0;">Shop</a>
                <a href="about.html" class="nav-link" style="font-size: 1.1rem; padding: 0.5rem 0;">About</a>
                <hr style="border-color: var(--border); margin: 0.5rem 0;">
                <a href="sell.html" class="nav-link" style="font-size: 1.1rem; padding: 0.5rem 0;">Sell</a>
                <a href="messages.html" class="nav-link" style="font-size: 1.1rem; padding: 0.5rem 0;">Messages</a>
                <a href="saved-items.html" class="nav-link" style="font-size: 1.1rem; padding: 0.5rem 0;">Saved Items</a>
                <a href="profile.html" class="nav-link" style="font-size: 1.1rem; padding: 0.5rem 0;">Profile</a>
                <hr style="border-color: var(--border); margin: 0.5rem 0;">
                <button onclick="logout()" class="btn btn-outline" style="text-align: center; width: 100%;">Log Out</button>
            </div>
        </div>
    </div>

    <main>
        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <h1 class="hero-title">Your Campus Marketplace</h1>
                <p class="hero-subtitle">Buy, sell, and connect with students on your campus.</p>

                <div class="hero-stats">
                    <div class="stat-item">
                        <span class="stat-number">5k+</span>
                        <span class="stat-label">Active Users</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">12k+</span>
                        <span class="stat-label">Transactions</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">98%</span>
                        <span class="stat-label">Happy Customers</span>
                    </div>
                </div>

                <a href="products.html" class="btn btn-hero">Start Exploring</a>
            </div>
        </section>

        <!-- Top Selling Section -->
        <section class="top-selling section-padding">
            <div class="container">
                <h2 class="section-title">TOP SELLING</h2>

                <!-- Product Grid - Populated dynamically -->
                <div class="product-grid" id="top-selling-grid">
                    <!-- Products loaded here via JavaScript -->
                    <div style="grid-column: 1/-1; text-align: center; padding: 2rem;">
                        <p style="color: var(--muted);">Loading products...</p>
                    </div>
                </div>

                <div class="view-all-container">
                    <a href="products.html" class="btn btn-outline btn-pill">View All Products</a>
                </div>
            </div>
        </section>

        <!-- Browse by Category Section -->
        <section class="categories section-padding bg-secondary">
            <div class="container">
                <h2 class="section-title">BROWSE BY CATEGORY</h2>

                <div class="category-grid">

                    <!-- Card 1: Textbooks (LEFT - full height) -->
                    <a href="products.html?category=Textbooks" class="category-card">
                        <img src="img/textbooks.jpg" alt="Textbooks">
                        <div class="category-overlay"></div>
                        <span class="category-name">Textbooks</span>
                    </a>

                    <!-- Card 2: Electronics (CENTER - top) -->
                    <a href="products.html?category=Electronics" class="category-card">
                        <img src="img/elect.jpg" alt="Electronics">
                        <div class="category-overlay"></div>
                        <span class="category-name">Electronics</span>
                    </a>

                    <!-- Card 3: Clothing (RIGHT - full height) -->
                    <a href="products.html?category=Clothing" class="category-card">
                        <img src="img/cloths.jpg" alt="Clothing">
                        <div class="category-overlay"></div>
                        <span class="category-name">Clothing</span>
                    </a>

                    <!-- Card 4: Furniture (CENTER - bottom) -->
                    <a href="products.html?category=Furniture" class="category-card">
                        <img src="https://images.unsplash.com/photo-1555041469-a586c61ea9bc?q=80&w=1000&auto=format&fit=crop"
                            alt="Furniture">
                        <div class="category-overlay"></div>
                        <span class="category-name">Furniture</span>
                    </a>

                </div>
            </div>
        </section>

        <!-- Newsletter Section -->
        <section class="newsletter-section section-padding">
            <div class="container">
                <div class="newsletter-card">
                    <div class="newsletter-content">
                        <h2 class="newsletter-title">STAY UP TO DATE ABOUT OUR LATEST OFFERS</h2>
                    </div>
                    <div class="newsletter-form-container">
                        <form class="newsletter-form">
                            <div class="email-input-wrapper">
                                <i data-lucide="mail" class="email-icon"></i>
                                <input type="email" placeholder="Enter your email address" class="newsletter-input">
                            </div>
                            <button type="button" class="btn btn-subscribe">Subscribe to Newsletter</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <a href="index.html" class="logo">UniMarket</a>
                    <p>The trusted marketplace for students. Buy, sell, and connect with your campus community.</p>
                    <div class="footer-socials">
                        <a href="#" class="social-btn"><i data-lucide="twitter" size="18"></i></a>
                        <a href="#" class="social-btn"><i data-lucide="facebook" size="18"></i></a>
                        <a href="#" class="social-btn"><i data-lucide="instagram" size="18"></i></a>
                        <a href="#" class="social-btn"><i data-lucide="github" size="18"></i></a>
                    </div>
                </div>

                <div class="footer-col">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="#">About</a></li>
                        <li><a href="#">Features</a></li>
                        <li><a href="#">Works</a></li>
                        <li><a href="#">Career</a></li>
                    </ul>
                </div>

                <div class="footer-col">
                    <h4>Help</h4>
                    <ul>
                        <li><a href="#">Customer Support</a></li>
                        <li><a href="#">Delivery Details</a></li>
                        <li><a href="#">Terms & Conditions</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>

                <div class="footer-col">
                    <h4>FAQ</h4>
                    <ul>
                        <li><a href="#">Account</a></li>
                        <li><a href="#">Manage Deliveries</a></li>
                        <li><a href="#">Orders</a></li>
                        <li><a href="#">Payments</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>UniMarket © 2000-2023, All Rights Reserved</p>
                <div class="payment-icons">
                    <!-- Placeholders for payment icons -->
                    <span>Visa</span>
                    <span>Mastercard</span>
                    <span>Paypal</span>
                    <span>Apple Pay</span>
                    <span>Google Pay</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        lucide.createIcons();
    </script>

    <script>
        // =============================================================================
        // LOAD TOP SELLING PRODUCTS - Fetch 5 most saved products dynamically
        // =============================================================================
        // This script runs on page load to fetch the top selling products
        // (the 5 most saved/bookmarked items from the database)
        // 
        // API ENDPOINT: GET /api/products/top-selling/featured
        // Returns: Array of top 5 products sorted by save count
        // 
        // RANKING LOGIC:
        // Products are ranked by how many times users have saved them (bookmarked)
        // This is the real measure of interest in a peer-to-peer marketplace
        
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Fetch top 5 most saved products from backend
                const response = await fetch('/api/products/top-selling/featured');
                
                if (!response.ok) {
                    console.error('Failed to load top selling products:', response.status);
                    showNoProducts();
                    return;
                }
                
                // Parse the products
                const products = await response.json();
                
                // If no products returned, show message
                if (!products || products.length === 0) {
                    showNoProducts();
                    return;
                }
                
                // Render the products
                renderTopSellingProducts(products);
                
            } catch (error) {
                console.error('Error loading top selling products:', error);
                showNoProducts();
            }
        });
        
        /**
         * Render top selling products in the grid
         * Creates HTML for each product with images, name, price, and save count
         */
        function renderTopSellingProducts(products) {
            const grid = document.getElementById('top-selling-grid');
            
            // Clear loading message
            grid.innerHTML = '';
            
            // Create a product card for each product
            const productsHTML = products.map(product => {
                // Get first image URL (with fallback)
                const imageUrl = product.images && product.images.length > 0 
                    ? getImageUrl(product.images[0].imageUrl)
                    : 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=800&auto=format&fit=crop';
                
                // Format price with ₦ symbol
                const formattedPrice = '₦' + product.price.toLocaleString();
                
                // Get seller name
                const sellerName = product.seller?.fullName || product.seller?.username || 'Unknown';
                
                // Return HTML for this product card
                return `
                    <a href="product-detail.html?id=${product.id}" class="product-card">
                        <div class="product-image-container">
                            <img src="${imageUrl}" 
                                alt="${product.name}" 
                                class="product-image" 
                                loading="lazy"
                                onerror="this.src='https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=800&auto=format&fit=crop'">
                            <button class="product-save-btn" onclick="event.preventDefault(); toggleSaveProduct(${product.id})">
                                <i data-lucide="bookmark"></i>
                            </button>
                        </div>
                        <div class="product-info">
                            <h3 class="product-name">${escapeHtml(product.name)}</h3>
                            <span class="product-price">${formattedPrice}</span>
                            <div class="product-stats">
                                <span class="stat" title="${product.saveCount} saves">
                                    <i data-lucide="heart" size="14"></i> ${product.saveCount}
                                </span>
                            </div>
                        </div>
                    </a>
                `;
            }).join('');
            
            // Insert products into grid
            grid.innerHTML = productsHTML;
            
            // Reinitialize Lucide icons for new elements
            lucide.createIcons();
        }
        
        /**
         * Show message when no products are available
         */
        function showNoProducts() {
            const grid = document.getElementById('top-selling-grid');
            grid.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 2rem;">
                    <p style="color: var(--muted);">No products available yet. Check back soon!</p>
                </div>
            `;
        }
        
        /**
         * Escape HTML special characters to prevent XSS
         */
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }
        
        /**
         * Toggle save status for a product (called when user clicks save button)
         * This is a placeholder - full implementation in products.html
         */
        function toggleSaveProduct(productId) {
            if (!isLoggedIn()) {
                alert('Please log in to save products');
                window.location.href = '/login.html';
                return;
            }
            // Toggle save (implementation in products.html)
            console.log('Save product:', productId);
        }
    </script>
    <script src="js/app.js"></script>
</body>

</html>